<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Just Search Portal</title> 
<link rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;,">
<link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="Just Search Portal" />
<meta id="viewport" name="viewport">
<script type="text/javascript">

// This file with its HTML, CSS and JavaScript is free software under the terms of the following license: https://justsearchportal.com/LICENSE

// Mobile viewport hack, from: 
// https://stackoverflow.com/a/39642318
function apply_viewport() {    
	var ww = window.screen.width;
	var mw = 450;
	var viewport_meta_tag = document.getElementById('viewport');
	if( ww < mw) { 
		var ratio = ww / mw;
		viewport_meta_tag.setAttribute('content', 'initial-scale=' + ratio + ', maximum-scale=' + ratio + ', minimum-scale=' + ratio + ', user-scalable=no, width=' + mw);
	}    
}
window.addEventListener('resize', function(){ apply_viewport(); });
apply_viewport();


</script>

<style>
html, body {
	height: 100%;
	margin: 0;
	font-family: helvetica, sans-serif;
}

.container {
	min-width: 380px;
	width: auto !important;
	height: 100%;
	display: flex;
	flex-direction: column;
}

.footer {
	width: fill;
	margin: 0 20px;
	border-top: 2px solid #a0a0a0;
	text-align: center;
}

.footer p {
	font-size: 11pt;
	margin:0.6em 0 0.8em 0;
}

.centerContainer {
	margin: auto 10px auto 10px;
	text-align: center;
}

.centerbox {
	max-width: 60em;
	margin: auto;
	text-align: center;
}

.title {
	font-weight: bold;
	font-size: 50pt;
	color: #d7d7d7;
	margin: 8px 0 15px 0;
}

.smallertitle {
	font-weight: bold;
	font-size: 32pt;
	color: #c0c0c0;
	margin: 30px 0 25px 0;
}

.btn {
	background-color: #a7e7a7;
	border: 2px solid #a0a0a0;
	vertical-align: bottom;
	color: black;
	min-width: 150px;
	height: 44px;
	display: inline-block;
	font-size: 15px;
	margin: 10px;
	cursor: pointer;
}

.btnDefault {
	border: 3px solid #404040;
}


.btnEmpty {
	background-color: white;
	border: 2px dashed #a0a0a0;
	vertical-align: bottom;
	min-width: 45px;
	height: 40px;
	display: inline-block;
	margin: 10px;
	cursor: pointer;
}

.ghost {
	opacity: .5;
}

.btnSlim {
	margin: 0 0 0 10px;
}

.manageTable {
    border-collapse: collapse;
    background-color: white;
    width: 100%;
}

.manageTable td, .manageTable th {
    padding: 5px;
    white-space:nowrap;
    text-align: left;
    padding-left: 16px;
}

.manageTable tr:hover {background-color: #ddd;}

.manageTable tr {
    border: 1px solid #aaa;    
}

.manageTable th {
    padding-top: 12px;
    padding-bottom: 12px;
    text-align: left;
	background-color: #f5f5f5;
	font-weight: bold;
}

.manageTable td:first-child {
  width:100%;
}



.btnFunction {
    padding: 6px 18px;
	margin: 5px 8px;
	cursor: pointer;
	font-size: 15px;
}

.btnOrganize {
	width: 42px;
	padding-left: 3px;	
	padding-right: 3px;	
	cursor: pointer;
}

.consentBox {
  border: 1px solid #aaa;
  padding: 0 20px 20px 20px;
  overflow:auto;
}

.buttonCell {
	background-color: #a7e7a7;
}

.extraBorder {
  border-top: 2px solid #000;
}

.segment {
  margin-top: 30px;
  margin-bottom: 30px;
}

.text {
  text-align: left;
}


label, input[type=radio] {
	cursor: pointer;
}

</style>
</head>

<body>
	<div class="container">
		<div class="centerContainer">
		<div class="centerbox">
			
		    <br>
		    <div id="askConsentBox" class="consentBox">
		    <h2 class="text">Cookie consent</h2>
		    <p class="text">To customize Just Search Portal a cookie must be used to save the settings. The cookie is not used for any other purpose and has a 1 year lifetime.</p>
		    <div style="float:right">
		    <button class="btnFunction" onClick="clickCookieReject()">No Thanks</button>
		    <button class="btnFunction" onClick="clickCookieAccept()"><b>Accept</b></button>
		    </div>
		    </div>
		    
		    <div id="customizeDiv">
			<p class="smallertitle">Click engines to swap position</p>
			<div class="segment" id="swapEngines"></div>
		    <button class="btnFunction" onClick="clickSwapUndo()">Undo</button>
			
			<p class="smallertitle">Select and configure engines</p>
			
			<div class="segment" id="allEngines"></div>
		    
		    
			<br>
			
			</div>
			
		    <div id="haveConsentBox" class="consentBox">
		    <div style="float:right;margin-top:25px">
		    <button class="btnFunction" onClick="clickCookieWithdraw()">Withdraw and revert to default settings</button>
		    </div>
		    <h2 class="text">Cookie consent</h2>	
		    </div>
			<br>	    
			
		</div>
		</div>
		<div class="footer">
			<p>Just Search Portal - Without distractions - Respecting privacy - <a href="https://github.com/larspontoppidan/just-search-portal">GitHub</a> - <a href="https://larsee.com/blog/2018/02/just-search-portal/">About</a></p>
		</div>
	</div>

		<script src="enginelist.js"></script>
		<script src="common.js"></script>
		<script>
		
		// Convenience functions
		// ---------------------
		
		Array.prototype.removeAt = function(index) {
            this.splice(index, 1);
		    return this;
		}

		Array.prototype.insertBefore = function(item, index) {
            this.splice(index, 0, item);
		    return this;
		}

		function deepCloneObject(x) {
			return JSON.parse(JSON.stringify(x));
		}
		
		// Cookie consent management
		// -------------------------
		
		function updateConsentState(got_consent) {
			var ask_box = document.getElementById('askConsentBox');
			var have_box = document.getElementById('haveConsentBox');
			var customize_div = document.getElementById('customizeDiv');
			if (got_consent) {
				ask_box.style.display = 'none';
				have_box.style.display = 'block';
				customize_div.style.display = 'block';
			}
			else {
				ask_box.style.display = 'block';
				have_box.style.display = 'none';
				customize_div.style.display = 'none';
			}
		}

		var state = stateLoadOrDefault();	
		updateConsentState(state.consent);
	    
		function clickCookieAccept() {
			state = stateGetAcceptDefaults();
			stateSave(state);
			updateConsentState(true);
		}
		
		function clickCookieReject() {
			stateErase();
			window.location.href = "index.html";
		}

		function clickCookieWithdraw() {
			stateErase();
			updateConsentState(false);
		}
		
		// Organize engines
		// ----------------
		
		function composeIndex(row, col) {
			return row*100 + col;
		}
		
	    function reorderEngines(engines, src_i, dst_i) {
			// Decompose indexes into row/col
			var src_row = Math.floor(src_i / 100) - 1;
			var src_col = src_i % 100;
			var dst_row = Math.floor(dst_i / 100) - 1;
			var dst_col = dst_i % 100;
			
			// Get source item and remove it
			var engine = engines[src_row][src_col];
			engines[src_row].removeAt(src_col);				
		
			// Insert at destination
			if (dst_row < 0) {
				engines.insertBefore([engine], 0);
			}
			else if (dst_row < engines.length) {
				engines[dst_row].insertBefore(engine, dst_col);					
			} 
			else {
				engines.push([engine]);					
			}
			
			return engines;
		} 
	    
	    function cleanEngines(engines) {
	    	// Remove empty rows in beginning and end
			while (engines[0].length == 0) {
				engines.removeAt(0);	
			}
			while (engines[engines.length - 1].length == 0) {
				engines.removeAt(engines.length - 1);	
			}
			return engines;
	    }

		function createEmptyTarget(func, id) {
			var elem = document.createElement('div');
			elem.classList.add('btnEmpty');
			elem.id = id;
			elem.addEventListener('click', func, false);
			return elem;
		}
	    
		function createSwapEngineDiv() {
			var div = document.createElement('div');
			var row = 0;
			var col = 0;

       		div.appendChild(createEmptyTarget(clickEngineMoveEmpty, composeIndex(row, col)));
    		div.appendChild(document.createElement('hr'));
    		
    		state.engines.forEach((columns) => {
				row += 1;
	       		div.appendChild(createEmptyTarget(clickEngineMoveEmpty, composeIndex(row, col)));
				columns.forEach((entry) => {
					var index = composeIndex(row, col);
	        		var elem = createSearchButton(entry, clickEngineMove, index);
	        		if ((selectedEngine != null) && 
	        			(selectedEngine != index))
	       			{
	       				elem.classList.add("ghost");
	       			}
	        		div.appendChild(elem);
	        	
		        	col += 1;
				});
				
				if (col > 0) {
		       		div.appendChild(createEmptyTarget(clickEngineMoveEmpty, composeIndex(row, col)));					
				}
				
	    		div.appendChild(document.createElement('hr'));	
	  		
	    		col = 0;
        	});	
			
			row += 1;
			
       		div.appendChild(createEmptyTarget(clickEngineMoveEmpty, composeIndex(row, col)));
    		
			return div;
		}

	    
		function updateSwapEngines() {
			var div = document.getElementById('swapEngines');
			while (div.children.length > 0) {
				div.removeChild(div.firstChild);
			}
			div.appendChild(createSwapEngineDiv());
		}
		

		function clickEngineMove() {
			if (selectedEngine == null) {
				selectedEngine = this.id;				
			}
			else if (selectedEngine == this.id) {
				selectedEngine = null;
			}
			else {
				state.engines = cleanEngines(reorderEngines(state.engines, selectedEngine, this.id));
				selectedEngine = null;
				stateSave(state);
			}

			updateSwapEngines();
		}
		
		function clickEngineMoveEmpty() {
			if (selectedEngine != null) {
				state.engines = cleanEngines(reorderEngines(state.engines, selectedEngine, this.id));
				selectedEngine = null;
				updateSwapEngines();
				stateSave(state);
			}
		}
		
		function clickSwapUndo() {
			state.engines = deepCloneObject(swapEnginesUndo);
			selectedEngine = null;
			updateSwapEngines();
			stateSave(state);
		}
		
		
	    var selectedEngine = null;
	    var swapEnginesUndo = deepCloneObject(state.engines);
	    
		updateSwapEngines();

		
		// Select and configure engines
		// ----------------------------
		
		
		
		
		// --- obsolete
		
		
	    var colorOptions = ["#f0c0c0", "#F89320", "#FFFF01", "#b0b0ff", "#e7e7e7", "#a7e7a7"];

    	function createImg(src, classes) {
    		var img = document.createElement("img");
    		img.src = src;
    		classes.forEach((cname) => {img.classList.add(cname);});
    		return img;
    	}
    	
    	function createImgBtn(src, func, id) {
    		var img = document.createElement("img");
    		img.src = src;
    		img.classList.add("btnOrganize");
    		img.id = id;
    		img.addEventListener('click', func, false);
    		return img;
    	}
    	
    	function createLink(text, link, classes) {
    		var e = document.createElement('a');
   		    e.setAttribute("href", link);
   		    e.innerHTML = text;
   		    classes.forEach((cname) => {e.classList.add(cname);});
   		    return e;
    	}
    	
    	function cycleColor(color) {
    		var i = colorOptions.indexOf(color) + 1;
    		if (i >= colorOptions.length) {
    			i = 0;
    		}
    		return colorOptions[i];
    	}
    	
    	function getEngineFromKey(key) {
    		ret = {};
    		searchEngineList.forEach((category) => {
    	    	category.engines.forEach((engine) => {
    	    		if (engine.key == key) {
    	    			ret = engine;
    	    		}
    	    	});
    		});
   	    	return ret;
    	}
    	
    	function getEngineCategory(key) {
    		ret = {};
    		searchEngineList.forEach((category) => {
    	    	category.engines.forEach((engine) => {
    	    		if (engine.key == key) {
    	    			ret = category;
    	    		}
    	    	});
    		});
   	    	return ret;
    	}
    	
    		
	    function createManageTable(engines) {
	        var tbl  = document.createElement('table');
	        tbl.classList.add("manageTable");		        
	        engines.forEach((entry, index) => {
	        	var tr = tbl.insertRow();
	        	if (entry.key == "NEWLINE") {
	        		var td = tr.insertCell();
	        	}
	        	else {
					var td = tr.insertCell();		        	
			        td.appendChild(createSearchButton(entry, usrToggleDefault, index));
			        td = tr.insertCell();
			        td.appendChild(createImgBtn("img/palette.png", usrChangeColor, index));
			        td = tr.insertCell();
			        td.appendChild(createImgBtn("img/up-arrow.png", usrEngineUp, index));
			        td.appendChild(createImgBtn("img/down-arrow.png", usrEngineDown, index));
			        td = tr.insertCell();
			        td.appendChild(createImgBtn("img/trash.png", usrEngineDelete, index));
	        	}
        	});
			return tbl;
	    }
	    
	    function updateEngines() {
	    	if (state.searchEngines[0].key == "NEWLINE") {
 				state.searchEngines.splice(0, 1);	
 			}
	    	
	    	if (state.searchEngines[state.searchEngines.length - 1].key == "NEWLINE") {
 				state.searchEngines.splice(state.searchEngines.length - 1, 1);	
 			}
	    	

			//setSearchEngines(makeDefaultEngineButtons(state.searchEngines));
			
		}
	    
	    function swapEngines(index1, index2) {
	    	var tmp = state.searchEngines[index1];
 			state.searchEngines[index1] = state.searchEngines[index2];
 			state.searchEngines[index2] = tmp;
	    }
	    
	    function insertEngineSeperator(index) {
	    	var obj = {};
	    	obj.key = "NEWLINE";
	    	state.searchEngines.splice(index, 0, obj);
	    }
	     
	    
	 	// User events:
	 		
    	function usrSaveChanges() {
	 		state.showAll = false;
	 		saveState(state);
    		window.location.href = "index.html";
	 	}

    	function usrDefaults() {
    		state = loadDefaults();
    		updateEngines();
    	}
    	
    	function usrBack() {
    		window.location.href = "index.html";
    	}
    	
    	function usrEngineUp() {
 			var idx = Number(this.id);
	 		if (idx == 0) {	 			
	 			if (state.searchEngines[1].key != "NEWLINE") {
	 				insertEngineSeperator(0);
	 				idx = 1;
	 			}
	 			else {
	 				return;
	 			}
 			}
 			swapEngines(idx - 1, idx);
	    	updateEngines();
	    }
	    
		function usrEngineDown() {
 			var idx = Number(this.id);
	 		if (idx < (state.searchEngines.length - 1)) {	 			
	 			swapEngines(idx + 1, idx);	 			
	 		}
	    	updateEngines();
	    }
		
		function usrEngineDelete() {
	 		state.searchEngines.splice(this.id, 1);
	    	updateEngines();
	    }
		
		function usrChangeColor() {
			state.searchEngines[this.id].color = cycleColor(state.searchEngines[this.id].color);
			updateEngines();
		}
		
		function usrToggleDefault() {
			var newValue = true;
			if (state.searchEngines[this.id].isDefault) {
				delete state.searchEngines[this.id].isDefault;
			} 
			else {
				state.searchEngines[this.id].isDefault = true;				
			}
			updateEngines();
		}
			    
	    function addEngine(key) {
			pos = findBestPosition(key);
			
	    	var obj = {};
	    	obj.key = key;
	    	state.searchEngines.splice( pos, 0, obj);
	    }
	    
	    function usrToggleEngine() {
	    	idx = findEngineIndex(this.id);
		    if (idx >= 0) {
		    	state.searchEngines.splice(idx, 1);
		    	this.src = "img/box-unchecked.png";   
		    }
		    else {
		    	addEngine(this.id);
                this.src = "img/box-checked.png";   
            }
	    	
	    	updateEngines();
	    }
	    
	    function findEngineIndex(key) {
	    	var result = -1;
	    	state.searchEngines.forEach((entry, index) => {
	    		if (entry.key == key) {
	    			result = index;
	    		}
	    	});
	    	return result;
	    }
	    
	    function findBestPosition(key) {
			var latestPos = 0;
			var result = 0;
		    searchEngineList.forEach((objCategory) => {
		    	var catPos = -1;
		    	objCategory.engines.forEach((engine) => {
		    		if (catPos == -1) {
			    		catPos = findEngineIndex(engine.key);
		    		}
		    	});
		    	if (catPos == -1) {
		    		catPos = latestPos;
		    	}
		    	var first = true;
		    	objCategory.engines.forEach((engine) => {
		    		pos = findEngineIndex(engine.key);
		    		if (pos != -1) {
		    			first = false;
		    			latestPos = pos + 1;
		    		}
		    		if (engine.key == key) {
		    			result = first ? catPos : latestPos;
		    		}
		    	});
		    });
		    
		    return result;
	    }
	    	    	    
	    function createCategoryTable(obj) {
	        var tbl  = document.createElement('table');
	        tbl.classList.add("manageTable");
	        var th = document.createElement('th');
	        th.appendChild(document.createTextNode(obj.category));
	        th.colSpan = 3;
	        tbl.insertRow().appendChild(th);
	        
	        obj.engines.forEach((engine) => {
	        	var td, tr = tbl.insertRow();
	        	td = tr.insertCell();
                   if (engine.about_url) {
					td.appendChild(createLink(engine.display_name, engine.about_url, []));
                   }
                   else {
                    td.appendChild(document.createTextNode(engine.display_name));                    	
                   }                   
                   td = tr.insertCell();
                   if (findEngineIndex(engine.key) >= 0) {
	                   img = "img/box-checked.png";                	   
                   }
                   else {
                	   img = "img/box-unchecked.png";
                   }
                   td.appendChild(createImgBtn(img, usrToggleEngine, engine.key));
        	});
			return tbl;
	    }
	    

	    divAllEngines = document.getElementById('allEngines');
	    
	    searchEngineList.forEach((category) => {
	    	divAllEngines.appendChild(createCategoryTable(category));
	    	divAllEngines.appendChild(document.createElement('br'));
		});

	    
		    
		
	</script>
</body>	
</html>
