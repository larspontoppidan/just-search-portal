<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Just Search Portal</title> 
<link rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;,">
<link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="Just Search Portal" />
<meta id="viewport" name="viewport">
<script type="text/javascript">

// This file with its HTML, CSS and JavaScript is free software under the terms of the following license: https://justsearchportal.com/LICENSE

// Mobile viewport hack, from: 
// https://stackoverflow.com/a/39642318
function apply_viewport() {    
	var ww = window.screen.width;
	var mw = 450;
	var viewport_meta_tag = document.getElementById('viewport');
	if( ww < mw) { 
		var ratio = ww / mw;
		viewport_meta_tag.setAttribute('content', 'initial-scale=' + ratio + ', maximum-scale=' + ratio + ', minimum-scale=' + ratio + ', user-scalable=no, width=' + mw);
	}    
}
window.addEventListener('resize', function(){ apply_viewport(); });
apply_viewport();


</script>

<style>
html, body {
	height: 100%;
	margin: 0;
	font-family: helvetica, sans-serif;
	background-color:#eee;
}

.container {
	min-width: 380px;
	width: auto !important;
	height: 100%;
	display: flex;
	flex-direction: column;
}

.footer {
	width: fill;
	margin: 0 20px;
	border-top: 2px solid #a0a0a0;
	text-align: center;
}

.footer p {
	font-size: 11pt;
	margin:0.6em 0 0.8em 0;
}

.centerContainer {
	margin: auto 10px auto 10px;
	text-align: center;
}

.centerbox {
	max-width: 60em;
	margin: auto;
	text-align: center;
}

.title {
	font-weight: bold;
	font-size: 50pt;
	color: #d7d7d7;
	margin: 8px 0 15px 0;
}

.smallertitle {
	font-weight: bold;
	font-size: 32pt;
	color: #c0c0c0;
	margin: 30px 0 25px 0;
}

.btn {
	background-color: #a7e7a7;
	border: 2px solid #a0a0a0;
	vertical-align: bottom;
	color: black;
	min-width: 150px;
	height: 44px;
	display: inline-block;
	font-size: 15px;
	margin: 10px;
	cursor: pointer;
}

.btnDefault {
	border: 3px solid #404040;
}


.btnEmpty {
	background-color: white;
	border: 2px dashed #a0a0a0;
	vertical-align: bottom;
	min-width: 45px;
	height: 40px;
	display: inline-block;
	margin: 10px;
	cursor: pointer;
}

.ghost {
	opacity: .5;
}

.btnSlim {
	margin: 0 0 0 10px;
}

.manageTable {
    border-collapse: collapse;
    background-color: white;
    width: 100%;
}

.manageTable td, .manageTable th {
    padding: 5px;
    white-space:nowrap;
    text-align: left;
    padding-left: 16px;
}


.manageTable tr {
    border: 1px solid #aaa;    
}

.manageTable th {
    padding-top: 12px;
    padding-bottom: 12px;
    text-align: left;
	background-color: #f5f5f5;
	font-weight: normal;
}

.manageTable td:nth-child(2) {
  width:100%;
}

.btnFunction {
    padding: 6px 18px;
	margin: 5px 8px;
	cursor: pointer;
	font-size: 15px;
}


.btn:hover {
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    transition-duration: 0.2s;
}

.btn:active {
    border: 2px solid black;
}

.btnOrganize {
	width: 42px;
	padding-left: 3px;	
	padding-right: 3px;	
	cursor: pointer;
}

.consentBox {
  background-color: white;
  border-radius: 4px;
  border: 1px solid #aaa;
  padding: 0 20px 20px 20px;
  overflow:auto;
}

.buttonCell {
	background-color: #a7e7a7;
}

.extraBorder {
  border-top: 2px solid #000;
}

.segment {
  margin-top: 30px;
  margin-bottom: 30px;
}

.text {
  text-align: left;
}


label, input[type=radio] {
	cursor: pointer;
}

hr {
  border-top: 1px solid #aaa;
  border-bottom: 0;
}

/* Style the tab */
.tab {
    background-color: inherit;
    overflow: hidden;
    border: 0;
    padding: 0;
	margin: 0;
}

/* Style the buttons inside the tab */
.tab button {
    background-color: inherit;
    float: left;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.2s;
    font-size: 17px;
    border: 0;
    border-bottom: 3px solid #d7d7d7;
}

/* Change background color of buttons on hover */
.tab button:hover {
    background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
    border-bottom: 3px solid red;
}


/* Custom checkbox */
.chkContainer {
    display: block;
    position: relative;
    padding-left: 35px;
    margin-left: 30px;
    margin-right: 30px;
    margin-bottom: 15px;
    line-height: 27px;
    cursor: pointer;
    font-size: 16px;
    text-align: left;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.chkContainer input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
}

.chkMark {
    position: absolute;
    top: 1;
    left: 0;
    height: 23px;
    width: 23px;
    background-color: #eee;
    border: 2px solid #555;
}

.chkContainer:hover input ~ .chkMark {
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    transition-duration: 0.2s;
}

.chkMark:after {
    content: "";
    position: absolute;
    display: none;
}

.chkContainer input:checked ~ .chkMark:after {
    display: block;
}

.chkContainer .chkMark:after {
    left: 8px;
    top: 4px;
    width: 5px;
    height: 10px;
    border: solid black;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
}




</style>
</head>

<body>
	<div class="container">
		<div class="centerContainer">
		<div class="centerbox">
			
		    <br>
		    <div id="askConsentBox" class="consentBox">
		    <h2 class="text">Cookie consent</h2>
		    <p class="text">To customize Just Search Portal a cookie must be used to save the settings. The cookie is not used for any other purpose and has a 1 year lifetime.</p>
		    <div style="float:right">
		    <button class="btnFunction" onClick="clickCookieReject()">No Thanks</button>
		    <button class="btnFunction" onClick="clickCookieAccept()"><b>Accept</b></button>
		    </div>
		    </div>
		    <br>
		    <div id="customizeDiv">
			
			<p class="smallertitle">Customize Just Search Portal</p>
		    
		    <div id="haveConsentBox" class="consentBox">
		    <div style="float:right;margin-top:25px">
		    <button class="btnFunction" onClick="clickCookieWithdraw()">Withdraw and revert to defaults</button>
		    </div>
		    <h2 class="text">Cookie consent</h2>	
		    </div>
		    <br>
			
			<div class="consentBox">
		    <h2 class="text">Default mode</h2>
		    
		    <div>
				<label class="chkContainer">Open in new tab
				  <input type="checkbox" id="chkNewTab" onClick="clickChkNewTab()">
				  <span class="chkMark"></span>
				</label>
				<label class="chkContainer">Show all engines
				  <input type="checkbox" id="chkShowAll" onClick="clickChkShowAll()">
				  <span class="chkMark"></span>
				</label>
			</div>
		    
		    <br>
		    </div>
		    
		    <br>
			
			<div class="consentBox">
		    <div style="float:right;margin-top:25px">
		    <button class="btnFunction" id="btnSwapUndo" onClick="clickSwapUndo()">Undo changes</button>
		    </div>
		    <h2 class="text">Modify Custom Engines Page</h2>
			    
			<div class="tab" id="customize_tab">
			  <button class="tablinks active" onclick="clickTab(0)">Layout</button>
			  <button class="tablinks" onclick="clickTab(1)">Default Engines</button>
			  <button class="tablinks" onclick="clickTab(2)">Engine Colors</button>
			</div>

			<div class="segment" id="swapEngines"></div>			
		    </div>

			<br>

			<div class="consentBox">
		    <h2 class="text">Select Search Engines</h2>
			
			<div class="segment" id="allEngines"></div>
		    			
			</div>
			
			<br>	    
			</div>
		</div>
		</div>
		<div class="footer">
			<p>Just Search Portal - Without distractions - Respecting privacy - <a href="https://github.com/larspontoppidan/just-search-portal">GitHub</a> - <a href="https://larsee.com/blog/2018/02/just-search-portal/">About</a></p>
		</div>
	</div>

		<script src="enginelist.js"></script>
		<script src="common.js"></script>
		<script>
		
		// Convenience functions
		// ---------------------
		
		Array.prototype.removeAt = function(index) {
            this.splice(index, 1);
		    return this;
		}

		Array.prototype.insertBefore = function(item, index) {
            this.splice(index, 0, item);
		    return this;
		}

		function deepCloneObject(x) {
			return JSON.parse(JSON.stringify(x));
		}
		
		// Cookie consent management
		// -------------------------
		
		function updateConsentState(got_consent) {
			var ask_box = document.getElementById('askConsentBox');
			var have_box = document.getElementById('haveConsentBox');
			var customize_div = document.getElementById('customizeDiv');
			if (got_consent) {
				ask_box.style.display = 'none';
				have_box.style.display = 'block';
				customize_div.style.display = 'block';
			}
			else {
				ask_box.style.display = 'block';
				have_box.style.display = 'none';
				customize_div.style.display = 'none';
			}
		}

		var state = stateLoadOrDefault();	
		updateConsentState(state.consent);
	    
		function clickCookieAccept() {
			state = stateGetAcceptDefaults();
			stateSave(state);
			updateConsentState(true);
		}
		
		function clickCookieReject() {
			stateErase();
			window.location.href = "index.html";
		}

		function clickCookieWithdraw() {
			stateErase();
			updateConsentState(false);
		}
		
		// Initial state
		// -------------
		
		var chkNewTab = document.getElementById('chkNewTab');
		var chkShowAll = document.getElementById('chkShowAll');
		chkNewTab.checked = state.newTab;		
		chkShowAll.checked = state.showAll;		
		
		function clickChkNewTab() {
			console.log("nt" + chkNewTab.checked);
			state.newTab = chkNewTab.checked;
			stateSave(state);
		}
		
		function clickChkShowAll() {
			console.log("sa" + chkShowAll.checked);
			state.showAll = chkShowAll.checked; 
			stateSave(state);
		}
		
		
		// Engine layout
		// ----------------
		
		function composeIndex(row, col) {
			return row*100 + col;
		}
		
	    function reorderEngines(engines, src_i, dst_i) {
			// Decompose indexes into row/col
			var src_row = Math.floor(src_i / 100) - 1;
			var src_col = src_i % 100;
			var dst_row = Math.floor(dst_i / 100) - 1;
			var dst_col = dst_i % 100;
			
			// Get source item and remove it
			var engine = engines[src_row][src_col];
			engines[src_row].removeAt(src_col);				
		
			// Insert at destination
			if (dst_row < 0) {
				engines.insertBefore([engine], 0);
			}
			else if (dst_row < engines.length) {
				engines[dst_row].insertBefore(engine, dst_col);					
			} 
			else {
				engines.push([engine]);					
			}
			
			return engines;
		} 
	    
	    function switchEngines(engines, src_i, dst_i) {
			// Decompose indexes into row/col
			var src_row = Math.floor(src_i / 100) - 1;
			var src_col = src_i % 100;
			var dst_row = Math.floor(dst_i / 100) - 1;
			var dst_col = dst_i % 100;
			
			// Swap source and dest engine
			var tmp = engines[src_row][src_col];
			engines[src_row][src_col] = engines[dst_row][dst_col];
			engines[dst_row][dst_col] = tmp;
			return engines;
		} 
	    
	    function cleanEngines(engines) {
	    	// Remove empty rows in beginning and end
			while (engines[0].length == 0) {
				engines.removeAt(0);	
			}
			while (engines[engines.length - 1].length == 0) {
				engines.removeAt(engines.length - 1);	
			}
			return engines;
	    }

		function createEmptyTarget(func, id) {
			var elem = document.createElement('div');
			elem.classList.add('btnEmpty');
			elem.id = id;
			elem.addEventListener('click', func, false);
			return elem;
		}
	    
		function createSwapEngineDiv() {
			var div = document.createElement('div');
			var row = 0;
			var col = 0;

       		div.appendChild(createEmptyTarget(clickEngineMoveEmpty, composeIndex(row, col)));
    		div.appendChild(document.createElement('hr'));
    		
    		state.engines.forEach((columns) => {
				row += 1;
	       		div.appendChild(createEmptyTarget(clickEngineMoveEmpty, composeIndex(row, col)));
				columns.forEach((entry) => {
					var index = composeIndex(row, col);
	        		var elem = createSearchButton(entry, clickEngineMove, index);
	        		if ((selectedEngine != null) && 
	        			(selectedEngine != index))
	       			{
	       				elem.classList.add("ghost");
	       			}
	        		div.appendChild(elem);
	        	
		        	col += 1;
				});
				
				if (col > 0) {
		       		div.appendChild(createEmptyTarget(clickEngineMoveEmpty, composeIndex(row, col)));					
				}
				
	    		div.appendChild(document.createElement('hr'));	
	  		
	    		col = 0;
        	});	
			
			row += 1;
			
       		div.appendChild(createEmptyTarget(clickEngineMoveEmpty, composeIndex(row, col)));
    		
			return div;
		}

		function clickToggleDefault() {
			var row = Math.floor(this.id / 100) - 1;
			var col = this.id % 100;
			if (state.engines[row][col].isDefault) {
				delete state.engines[row][col].isDefault;
			}
			else {
				state.engines[row][col].isDefault = true;
			}

			updateSwapEngines();
			stateSave(state);
		}

	    var colorOptions = ["#f0c0c0", "#F89320", "#FFFF01", "#b0b0ff", "#e7e7e7", "#a7e7a7"];
	    
    	function cycleColor(color) {
    		var i = colorOptions.indexOf(color) + 1;
    		if (i >= colorOptions.length) {
    			i = 0;
    		}
    		return colorOptions[i];
    	}

		function clickToggleColor(index) {
			var row = Math.floor(this.id / 100) - 1;
			var col = this.id % 100;
			state.engines[row][col].color = cycleColor(state.engines[row][col].color);
			updateSwapEngines();
			stateSave(state);
		}

		function createToggleEngineDiv(button_func) {
			var div = document.createElement('div');
			var row = 0;
			var col = 0;

    		div.appendChild(document.createElement('br'));
    		
    		state.engines.forEach((columns) => {
				row += 1;
				columns.forEach((entry) => {
					var index = composeIndex(row, col);
	        		var elem = createSearchButton(entry, button_func, index);	        		
	        		div.appendChild(elem);
	        	
		        	col += 1;
				});
				
	    		div.appendChild(document.createElement('br'));	
	  		
	    		col = 0;
        	});	
			
			row += 1;
			
			return div;
		}

	    
		function updateSwapEngines() {
			var new_content;
			if (customizeMode == 0) {
				new_content = createSwapEngineDiv();
			}
			else if (customizeMode == 1) {
				new_content = createToggleEngineDiv(clickToggleDefault);
			}
			else if (customizeMode == 2) {
				new_content = createToggleEngineDiv(clickToggleColor);
			}
			
			var div = document.getElementById('swapEngines');
			while (div.children.length > 0) {
				div.removeChild(div.firstChild);
			}
			div.appendChild(new_content);
		}
		
		function showSwapEngineUndo(x) {
			document.getElementById('btnSwapUndo').style.display = x ? "block" : "none";
		}

		function clickEngineMove() {
			if (selectedEngine == null) {
				selectedEngine = this.id;				
			}
			else if (selectedEngine == this.id) {
				selectedEngine = null;
			}
			else {
				state.engines = cleanEngines(switchEngines(state.engines, selectedEngine, this.id));
				selectedEngine = null;
				stateSave(state);
				showSwapEngineUndo(true);
			}

			updateSwapEngines();
		}
		
		function clickEngineMoveEmpty() {
			if (selectedEngine != null) {
				state.engines = cleanEngines(reorderEngines(state.engines, selectedEngine, this.id));
				selectedEngine = null;
				updateSwapEngines();
				showSwapEngineUndo(true);
				stateSave(state);
			}
		}
		
		function clickSwapUndo() {
			state.engines = deepCloneObject(swapEnginesUndo);
			selectedEngine = null;
			updateSwapEngines();
			stateSave(state);
			showSwapEngineUndo(false);
		}
		
		
	    var selectedEngine = null;
	    var swapEnginesUndo = deepCloneObject(state.engines);
	    var customizeMode = 0; 
	    
		updateSwapEngines();
		showSwapEngineUndo(false);
		

		function clickTab(tab_no) {
			var tab_div = document.getElementById('customize_tab');
			for (var i = 0; i < tab_div.children.length; i++) {
				tab_div.children[i].className = (i == tab_no) ? "tablinks active" : "tablinks";				
			}
			
			customizeMode = tab_no;
			updateSwapEngines();
		}
		

		// Undo management
		// ---------------
		
		
		
		
		// Select and configure engines
		// ----------------------------
		
	    function findEngine(key) {
	    	var result = null;
	    	state.engines.forEach((columns, row) => {
	    		columns.forEach((entry, col) => {
		    		if (entry.key == key) {
		    			result = entry;
		    		}
	    		});
	    	});
	    	return result;
	    }

		function addEngine(key) {
			var obj = {};
	    	obj.key = key;
		}

		function removeEngine(key) {
			console.log("remove " + key);
			var result = null;
	    	state.engines.forEach(columns => {
	    		for (var i = 0; i < columns.length; i++) {
		    		if (columns[i].key == key) {
		    			columns.removeAt(i);
		    			i -= 1;
		    		}
	    		}
	    	});
		}
		
		
		function clickChkEngine() {
			if (this.checked) {
				addEngine(this.id);
			} 
			else {
				removeEngine(this.id);
			}
			
			updateSwapEngines();
		}
		
		function makeChkBox(text, checked, on_click, id) {
			var lbl = document.createElement('label');
			lbl.className = "chkContainer";
			lbl.innerHtml = text;
			lbl.appendChild(document.createTextNode(text));
			
			var input = document.createElement('input');
			input.type = "checkbox";
			input.id = id;
			input.checked = checked;
			input.addEventListener('click', on_click, false);
			lbl.appendChild(input);
			
			var span = document.createElement('span');
			span.className = "chkMark";
			lbl.appendChild(span);
			
			return lbl;
		}
		
	    function createCategoryElements(obj, parent) {
	    	
	    	var header;
	    	header = document.createElement('h3');
	    	header.appendChild(document.createTextNode(obj.category));
	    	header.style.textAlign = "left";
	    	parent.appendChild(header);
	    	
		    obj.engines.forEach((engine) => {		    	
			    var name = engine.description ? engine.description : engine.display_name;
			    var entry = findEngine(engine.key);
			    
		    	parent.appendChild(makeChkBox(name, entry != null, clickChkEngine, engine.key));
		    	
		    });
		    
		    parent.appendChild(document.createElement('br'));
	    }
	    

	    divAllEngines = document.getElementById('allEngines');
	    
	    searchEngineList.forEach((category) => {
	    	createCategoryElements(category, divAllEngines);	    	
		});
		    
		
	</script>
</body>	
</html>
